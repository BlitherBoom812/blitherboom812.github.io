<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Blither Boom"><meta name="copyright" content="Blither Boom"><meta name="generator" content="Hexo 6.2.0"><meta name="theme" content="hexo-theme-yun"><title>æ‰©æ•£æ¨¡å‹ï¼ˆä¸€ï¼‰DDPM åŸç†å­¦ä¹  | Guo_Yun</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script type="module">import { renderKatex } from '/js/utils.js'
document.addEventListener("DOMContentLoaded", () => {
  renderKatex({
    ...{},
    ...true?.options,
  });
});</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"blitherboom812.github.io","root":"/","title":["æ‘¸","ğŸŸ","äºº","çš„","æ—¥","å¸¸"],"version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap"><meta name="description" content="æœ€è¿‘çœ‹äº† lhy çš„ Diffusion Model æ•™ç¨‹ï¼Œå¯¹äºä¹‹å‰ä¸€ç›´ä¸ç†è§£çš„ Diffusion Model çš„è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ç»ˆäºè·å¾—äº†æ–°çš„è®¤è¯†ï¼Œè¿˜å’Œ VAEï¼ŒFlow-based ç­‰æ–¹æ³•æ„å»ºèµ·äº†ç»Ÿä¸€çš„è”ç³»ã€‚è¿™ç¯‡ç¬”è®°ä½œä¸ºå¯¹äº DDPM è®ºæ–‡å…¬å¼æ¨å¯¼çš„ä¸€ä¸ªå°è¯•ã€‚ å›¾åƒç”Ÿæˆä»»åŠ¡çš„ä¼˜åŒ–ç›®æ ‡ä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­ï¼ŒåŒæ ·çš„ä¸€å¥è¯ï¼Œå¯ä»¥ç”Ÿæˆæ— é™çš„å›¾åƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½æ„å»ºèµ·ä»å¥å­åˆ°å›¾åƒçš„å”¯ä¸€æ˜ å°„ã€‚å¥½åœ¨æˆ‘ä»¬è¿˜æœ‰æ¦‚">
<meta property="og:type" content="article">
<meta property="og:title" content="æ‰©æ•£æ¨¡å‹ï¼ˆä¸€ï¼‰DDPM åŸç†å­¦ä¹ ">
<meta property="og:url" content="https://blitherboom812.github.io/2025/07/25/DDPM/index.html">
<meta property="og:site_name" content="Guo_Yun">
<meta property="og:description" content="æœ€è¿‘çœ‹äº† lhy çš„ Diffusion Model æ•™ç¨‹ï¼Œå¯¹äºä¹‹å‰ä¸€ç›´ä¸ç†è§£çš„ Diffusion Model çš„è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ç»ˆäºè·å¾—äº†æ–°çš„è®¤è¯†ï¼Œè¿˜å’Œ VAEï¼ŒFlow-based ç­‰æ–¹æ³•æ„å»ºèµ·äº†ç»Ÿä¸€çš„è”ç³»ã€‚è¿™ç¯‡ç¬”è®°ä½œä¸ºå¯¹äº DDPM è®ºæ–‡å…¬å¼æ¨å¯¼çš„ä¸€ä¸ªå°è¯•ã€‚ å›¾åƒç”Ÿæˆä»»åŠ¡çš„ä¼˜åŒ–ç›®æ ‡ä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­ï¼ŒåŒæ ·çš„ä¸€å¥è¯ï¼Œå¯ä»¥ç”Ÿæˆæ— é™çš„å›¾åƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½æ„å»ºèµ·ä»å¥å­åˆ°å›¾åƒçš„å”¯ä¸€æ˜ å°„ã€‚å¥½åœ¨æˆ‘ä»¬è¿˜æœ‰æ¦‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blitherboom812.github.io/images/DDPM/1753424129654.png">
<meta property="og:image" content="https://blitherboom812.github.io/images/DDPM/1753442174434.png">
<meta property="article:published_time" content="2025-07-25T04:11:59.000Z">
<meta property="article:modified_time" content="2025-10-15T11:50:59.000Z">
<meta property="article:author" content="Blither Boom">
<meta property="article:tag" content="paper">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blitherboom812.github.io/images/DDPM/1753424129654.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script><!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/latex.css"><link rel="stylesheet" type="text/css" href="/css/fonts.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Blither Boom"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Blither Boom"></a><div class="site-author-name"><a href="/about/">Blither Boom</a></div><span class="site-name">Guo_Yun</span><sub class="site-subtitle"></sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">33</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">0</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">7</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E7%94%9F%E6%88%90%E4%BB%BB%E5%8A%A1%E7%9A%84%E4%BC%98%E5%8C%96%E7%9B%AE%E6%A0%87"><span class="toc-number">1.</span> <span class="toc-text">å›¾åƒç”Ÿæˆä»»åŠ¡çš„ä¼˜åŒ–ç›®æ ‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VAE-%E7%9A%84%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">VAE çš„ä¼˜åŒ–è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%87%E8%AE%BE%E4%B8%BA%E9%AB%98%E6%96%AF%E5%88%86%E5%B8%83"><span class="toc-number">2.1.</span> <span class="toc-text">å‡è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%82%E6%9C%80%E5%A4%A7%E4%BC%BC%E7%84%B6%E7%9A%84%E4%B8%8B%E7%95%8C"><span class="toc-number">2.2.</span> <span class="toc-text">æ±‚æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDPM-%E7%9A%84%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">DDPM çš„ä¼˜åŒ–è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E5%AF%BC%E6%9C%80%E5%A4%A7%E4%BC%BC%E7%84%B6%E7%9A%84%E4%B8%8B%E7%95%8C"><span class="toc-number">3.1.</span> <span class="toc-text">æ¨å¯¼æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-ELBO-%E6%8E%A8%E5%AF%BC-DDPM-%E8%AE%AD%E7%BB%83%E6%97%B6%E7%9A%84%E4%BC%98%E5%8C%96%E7%9B%AE%E6%A0%87"><span class="toc-number">3.2.</span> <span class="toc-text">ä» ELBO æ¨å¯¼ DDPM è®­ç»ƒæ—¶çš„ä¼˜åŒ–ç›®æ ‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%9F%E6%AD%A3%E7%9A%84-DDPM-%E8%AE%AD%E7%BB%83"><span class="toc-number">3.3.</span> <span class="toc-text">çœŸæ­£çš„ DDPM è®­ç»ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%99%AA%E8%BF%87%E7%A8%8B%E7%9A%84%E7%BB%86%E8%8A%82"><span class="toc-number">3.3.1.</span> <span class="toc-text">åŠ å™ªè¿‡ç¨‹çš„ç»†èŠ‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97-DDPM-%E7%9A%84%E4%BC%98%E5%8C%96%E7%9B%AE%E6%A0%87"><span class="toc-number">3.3.2.</span> <span class="toc-text">è®¡ç®— DDPM çš„ä¼˜åŒ–ç›®æ ‡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DDPM-%E7%9A%84%E6%8E%A8%E7%90%86%E8%BF%87%E7%A8%8B"><span class="toc-number">3.4.</span> <span class="toc-text">DDPM çš„æ¨ç†è¿‡ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">å…¶ä»–é—®é¢˜</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://blitherboom812.github.io/2025/07/25/DDPM/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Blither Boom"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Guo_Yun"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">æ‰©æ•£æ¨¡å‹ï¼ˆä¸€ï¼‰DDPM åŸç†å­¦ä¹ </h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="Created: 2025-07-25 12:11:59" itemprop="dateCreated datePublished" datetime="2025-07-25T12:11:59+08:00">2025-07-25</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="Modified: 2025-10-15 19:50:59" itemprop="dateModified" datetime="2025-10-15T19:50:59+08:00">2025-10-15</time></div><div class="post-classify"><span class="post-tag"><a class="tag-item" href="/tags/paper/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">paper</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><p>æœ€è¿‘çœ‹äº† lhy çš„ Diffusion Model æ•™ç¨‹ï¼Œå¯¹äºä¹‹å‰ä¸€ç›´ä¸ç†è§£çš„ Diffusion Model çš„è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ç»ˆäºè·å¾—äº†æ–°çš„è®¤è¯†ï¼Œè¿˜å’Œ VAEï¼ŒFlow-based ç­‰æ–¹æ³•æ„å»ºèµ·äº†ç»Ÿä¸€çš„è”ç³»ã€‚è¿™ç¯‡ç¬”è®°ä½œä¸ºå¯¹äº DDPM è®ºæ–‡å…¬å¼æ¨å¯¼çš„ä¸€ä¸ªå°è¯•ã€‚</p>
<h2 id="å›¾åƒç”Ÿæˆä»»åŠ¡çš„ä¼˜åŒ–ç›®æ ‡"><a href="#å›¾åƒç”Ÿæˆä»»åŠ¡çš„ä¼˜åŒ–ç›®æ ‡" class="headerlink" title="å›¾åƒç”Ÿæˆä»»åŠ¡çš„ä¼˜åŒ–ç›®æ ‡"></a>å›¾åƒç”Ÿæˆä»»åŠ¡çš„ä¼˜åŒ–ç›®æ ‡</h2><p>ä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­ï¼ŒåŒæ ·çš„ä¸€å¥è¯ï¼Œå¯ä»¥ç”Ÿæˆæ— é™çš„å›¾åƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½æ„å»ºèµ·ä»å¥å­åˆ°å›¾åƒçš„å”¯ä¸€æ˜ å°„ã€‚å¥½åœ¨æˆ‘ä»¬è¿˜æœ‰æ¦‚ç‡çš„å·¥å…·ï¼šæˆ‘ä»¬å‡è®¾ï¼Œæ‰€æœ‰çš„å›¾åƒéƒ½æ˜¯ä»æŸä¸ªæ¦‚ç‡åˆ†å¸ƒä¸­é‡‡æ ·å‡ºæ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾ç”Ÿå›¾æ¨¡å‹çš„æç¤ºè¯ä¸å›¾åƒçš„æŸä¸ªæ¦‚ç‡åˆ†å¸ƒå¯¹åº”ï¼Œç”Ÿå›¾æ¨¡å‹çš„ä»»åŠ¡å°±æ˜¯è¾“å…¥æç¤ºè¯ï¼Œè¾“å‡ºç›®æ ‡å›¾åƒçš„æ¦‚ç‡åˆ†å¸ƒï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ä»å›¾åƒçš„æ¦‚ç‡åˆ†å¸ƒä¸­é‡‡æ ·å‡ºç›®æ ‡å›¾åƒã€‚</p>
<p>ç„¶è€Œï¼Œå›¾åƒçš„æ¦‚ç‡åˆ†å¸ƒå¼‚å¸¸å¤æ‚ï¼Œä»…å‡­äººåŠ›æ— æ³•ç»™å‡ºå…¶è¡¨è¾¾å¼ï¼Œå¾ˆéš¾å¯¹å…¶è¿›è¡Œå»ºæ¨¡ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°è¯•ä»æœ€ç®€æ´çš„é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ï¼Œå°†é«˜æ–¯åˆ†å¸ƒä¸­çš„æ¯ä¸€ä¸ªå‘é‡å¯¹åº”äºä¸€å¼ å›¾ç‰‡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠå¤æ‚çš„æ¦‚ç‡åˆ†å¸ƒå˜æˆäº†é«˜æ–¯åˆ†å¸ƒï¼Œéœ€è¦å­¦ä¹ çš„åªæ˜¯ï¼ˆåœ¨ç»™å®šæç¤ºè¯æ—¶ï¼‰ä»å‘é‡åˆ°å›¾ç‰‡çš„æ˜ å°„ã€‚è¿™å°±æ˜¯ VAE(å…¶å®æ˜¯ AEï¼ŒVAE æ›´å‡†ç¡®çš„è¯´æ˜¯ç”Ÿæˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒ) çš„åŸç†ï¼Œåˆšåˆšæåˆ°çš„é«˜æ–¯åˆ†å¸ƒçš„å‘é‡ç§°ä¸ºç¼–ç ï¼ŒæŠŠå‘é‡æ˜ å°„ä¸ºå›¾ç‰‡çš„æ¨¡å‹ç§°ä¸ºè§£ç å™¨ï¼ˆdecoderï¼‰ã€‚è€Œæ‰©æ•£æ¨¡å‹æŸç§æ„ä¹‰ä¸Šæ˜¯å¤šä¸ª VAE decoder çš„çº§è”ã€‚</p>
<p>ï¼ˆæ³¨æ„ï¼Œæ¥ä¸‹æ¥çš„æ¨å¯¼åŒæ—¶é€‚ç”¨äº VAE å’Œ Diffusion modelï¼‰</p>
<p>é¦–å…ˆä»é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ä¸€ä¸ªå‘é‡  $z$ ï¼Œå®ƒé€šè¿‡ç”Ÿæˆæ¨¡å‹ï¼Œå˜æˆäº†ä¸€å¼ å›¾ç‰‡  $x=G_{\theta}(z)$ ã€‚æˆ‘ä»¬å¯ä»¥é‡‡æ ·å¾ˆå¤šçš„  $z$ ï¼Œä¸åœåœ°ç”Ÿæˆ  $x$ ï¼Œé‚£ä¹ˆç”Ÿæˆæ¨¡å‹çš„åŠŸèƒ½å°±æ˜¯æŠŠä¸€ä¸ª  $z$  æ‰€åœ¨ç©ºé—´çš„é«˜æ–¯åˆ†å¸ƒé‡æ–°å¡‘å½¢æˆäº†  $x$  ç©ºé—´çš„å›¾åƒåˆ†å¸ƒã€‚æˆ‘ä»¬æŠŠé‡å¡‘å¾—åˆ°çš„è¿™ä¸ªå›¾åƒåˆ†å¸ƒè®°ä¸º  $P_{\theta}$ ï¼Œä»»æ„ä¸€å¼ å›¾åƒ  $x$  åœ¨è¿™ä¸ªåˆ†å¸ƒçš„ç”Ÿæˆæ¦‚ç‡ä¸º  $P_{\theta}(x)$ ã€‚ä»¥ä¸Šçš„  $\theta$  ä¸ºå¯ä»¥è®­ç»ƒçš„å‚æ•°ã€‚å¯ä»¥çœ‹å‡ºï¼Œåˆ†å¸ƒ  $P_{\theta}$  ä¸æ˜¯ç›´æ¥ç”±æ¨¡å‹äº§ç”Ÿçš„ï¼Œ $G_{\theta}$ æ‰æ˜¯æ¨¡å‹ï¼Œè€Œæ˜¯é—´æ¥åœ°ä»é«˜æ–¯åˆ†å¸ƒå’Œæ¨¡å‹  $G_{\theta}$  æ¨å‡ºæ¥çš„ã€‚</p>
<p>é‚£ä¹ˆï¼Œä¸ºäº†èƒ½å¤Ÿç”Ÿæˆé€¼çœŸçš„å›¾åƒï¼Œæˆ‘ä»¬å¸Œæœ›ç”Ÿæˆæ¨¡å‹çš„åˆ†å¸ƒ  $P_{\theta}$  å’Œè®­ç»ƒæ•°æ®çš„åˆ†å¸ƒ  $P_{data}$  è¶Šç›¸è¿‘è¶Šå¥½ï¼Œä»è®­ç»ƒæ•°æ®é›†ä¸­é€‰æ‹©è‹¥å¹²çœŸå®å›¾åƒ  $x^1, x^2, \dots, x^m \sim P_{data}$ ï¼Œé‚£ä¹ˆä¼˜åŒ–ç›®æ ‡å°±æ˜¯å°½å¯èƒ½å¢åŠ å®ƒä»¬çš„ç”Ÿæˆæ¦‚ç‡ï¼ˆæœ€å¤§åŒ–ä¼¼ç„¶ï¼ŒMaximum Likelihoodï¼‰ï¼š</p>

$$
\theta^* = \argmax_{\theta} \prod_{i=1}^mP_{\theta}(x^i)
$$


<p>ï¼ˆæ³¨ï¼šè¦å­¦ä¹ å›¾åƒçš„åˆ†å¸ƒï¼Œæ‰€éœ€çš„æ•°æ®é‡æ˜¯å·¨å¤§çš„ï¼Œå¤§çº¦æ˜¯ 1B é‡çº§çš„å›¾ç‰‡æ‰è¶³ä»¥è®­ç»ƒç°æœ‰çš„ diffusion modelã€‚ï¼‰</p>
<p>ä¸ºä»€ä¹ˆä¸Šé¢è¿™ä¸ªä¼˜åŒ–ç›®æ ‡èƒ½å¤Ÿä½¿å¾—  $P_{\theta}$  æ¥è¿‘  $P_{data}$  å‘¢ï¼Ÿé€šè¿‡ä¸€ç•ªå…¬å¼æ¨å¯¼ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¼˜åŒ–ç›®æ ‡å˜æˆä¸‹åˆ—å½¢å¼ï¼š</p>

$$
\begin{align*}
\theta^* &= \argmax_{\theta} \prod_{i=1}^mP_{\theta}(x^i)\\
&= \argmax_{\theta} \sum_{i=1}^m\log P_{\theta}(x^i)\\
&\approx \argmax_{\theta} E_{x\sim P_{data}}[\log P_{\theta}(x)]\\
&= \argmax_{\theta} \int_x P_{data}(x)\log  P_{\theta}(x)\mathrm dx\\
&= \argmax_{\theta} \int_x P_{data}(x)\log  P_{\theta}(x)\mathrm dx - \argmax_{\theta} \int_x P_{data}(x)\log  P_{data}(x)\mathrm dx\\
&= \argmax_{\theta}  \int_x P_{data}(x)\frac{\log  P_{\theta}(x)\mathrm dx}{\log  P_{data}(x)\mathrm dx}\\
&= \argmin_{\theta} KL[P_{data}||P_{\theta}]
\end{align*}
$$


<p>å¯ä»¥çœ‹å‡ºï¼Œæœ€å¤§åŒ–ä¼¼ç„¶å…¶å®å’Œæœ€å°åŒ– KL æ•£åº¦ç­‰ä»·ã€‚å…¶ä¸­çº¦ç­‰å·é‚£ä¸€æ­¥æ˜¯åˆ©ç”¨è’™ç‰¹å¡æ´›é‡‡æ ·ã€‚è€Œ KL æ•£åº¦çš„æ„ä¹‰æ­£æ˜¯â€œåº¦é‡åˆ†å¸ƒ p å’Œåˆ†å¸ƒ q ä¹‹é—´çš„è·ç¦»â€ï¼Œè¿™ä¸ªå€¼è¶Šå°ï¼Œåˆ™ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒè¶Šæ¥è¿‘ã€‚</p>
<h2 id="VAE-çš„ä¼˜åŒ–è¿‡ç¨‹"><a href="#VAE-çš„ä¼˜åŒ–è¿‡ç¨‹" class="headerlink" title="VAE çš„ä¼˜åŒ–è¿‡ç¨‹"></a>VAE çš„ä¼˜åŒ–è¿‡ç¨‹</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼˜åŒ–ä¸€ä¸‹ VAEã€‚</p>
<h3 id="å‡è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒ"><a href="#å‡è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒ" class="headerlink" title="å‡è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒ"></a>å‡è®¾ä¸ºé«˜æ–¯åˆ†å¸ƒ</h3><p>å…·ä½“è€Œè¨€ï¼Œå¯¹äº VAE æ¥è¯´ï¼š</p>

$$
P_{\theta}(x) = \int_z P_{\theta}(x|z)P(z)\mathrm dz
$$


<p>è€Œ  $P_{\theta}(x|z)$  å°±æ˜¯â€œç»™å®šé«˜æ–¯å‘é‡  $z$  ï¼Œäº§ç”Ÿå›¾åƒ  $x$  çš„æ¦‚ç‡â€ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬çš„è§£ç å™¨  $G_\theta$  å—ï¼é—æ†¾çš„æ˜¯ï¼Œ $G_{\theta}$  æ˜¯ä¸€ä¸ªç¡®å®šæ€§çš„æ˜ å°„ï¼Œä¸æ˜¯ä¸€ä¸ªæ¦‚ç‡ï¼Œå¦‚æœéè¦è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ¦‚ç‡çš„è¯ï¼Œå®ƒä¼šå˜æˆåªæœ‰åœ¨æŸå‡ ä¸ªç‰¹å®šç‚¹æ¦‚ç‡ä¸º 1ï¼Œå…¶ä»–ç‚¹çš„æ¦‚ç‡ä¸º 0ï¼š</p>

$$
P_\theta(x|z) = \begin{cases}
1, G_\theta(z) = x\\
0, G_\theta(z) \neq x
\end{cases}
$$


<p>è¿™å¥½åƒä¸å¤ªå¥½ï¼Œæˆ‘ä»¬å‡å®šå›¾åƒæ˜¯ä¸€ä¸ªè¿ç»­ç©ºé—´ï¼Œå¦‚æœ  $P_{\theta}(x|z)$  åªåœ¨å‡ ä¸ªç‰¹å®šçš„ç¦»æ•£ç‚¹é 0 çš„è¯ï¼Œé‚£ç›®æ ‡å‡½æ•°å°±å˜æˆä¸€ä¸ªéš¾ä»¥ä¼˜åŒ–çš„ä¸œè¥¿äº†ï¼ç¦»æ•£çš„ä¸œè¥¿æ€ä¹ˆæ±‚å¯¼å‘¢ï¼Ÿä¸ºäº†å…‹æœè¿™ä¸ªå›°éš¾ï¼Œæˆ‘ä»¬å†³å®šå°†è§£ç å™¨  $G_{\theta}$  ä»ä¸€ä¸ªç¡®å®šæ€§æ˜ å°„æ¢æˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œè¦ä¸å°±å‡è®¾ä»–æ˜¯é«˜æ–¯åˆ†å¸ƒå§ï¼š</p>

$$
x|z \sim \mathcal N (G_\theta(z), \sigma^2 I)\\
P_\theta (x|z) \propto \exp(-||G_\theta(z) - x||_2^2/2\sigma^2)
$$


<p>å¯ä»¥çœ‹åˆ°è§£ç å™¨  $G_{\theta}$  è¾“å‡ºçš„ä¸å†æ˜¯â€œå‘é‡å¯¹åº”çš„å›¾åƒâ€ï¼Œè€Œæ˜¯â€œå‘é‡å¯¹åº”å›¾åƒçš„é«˜æ–¯åˆ†å¸ƒå‡å€¼â€ã€‚â€œå‡è®¾å›¾åƒæ˜¯é«˜æ–¯åˆ†å¸ƒâ€æ˜¯ä¸ªå¾ˆç³Ÿç³•çš„å‡è®¾ï¼Œå®ƒçœ‹èµ·æ¥è·Ÿäº‹å®å®Œå…¨ä¸ç¬¦ï¼Œä¸è¿‡ï¼Œè‡³å°‘è¿™ä¸ªé«˜æ–¯çš„æ¦‚ç‡è¡¨è¾¾å¼å¯ä»¥æ‹¿å»æ±‚å¯¼ã€‚éšç€æ¢¯åº¦ä¸‹é™çš„æ¬¡æ•°å¢å¤šï¼Œ $G_\theta (z)$  åº”è¯¥ä¼šå’Œ  $x$  è¶Šæ¥è¶Šæ¥è¿‘ã€‚</p>
<h3 id="æ±‚æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ"><a href="#æ±‚æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ" class="headerlink" title="æ±‚æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ"></a>æ±‚æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ</h3><p>æˆ‘ä»¬å›åˆ°æœ€å¤§ä¼¼ç„¶å½¢å¼çš„ä¼˜åŒ–ç›®æ ‡è¿›è¡Œå˜å½¢ï¼š</p>

$$
\log P_{\theta}(x) = \int_z q(z|x) \log P_\theta(x) \mathrm dz
$$


<p>ï¼ˆæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ª  $q(z|x)$ ï¼Œè¿™ä¸ªä¸œè¥¿å¯ä»¥æ˜¯ä»»ä½•æ¦‚ç‡åˆ†å¸ƒï¼Œä¸Šå¼å§‹ç»ˆæˆç«‹ï¼‰</p>

$$
\begin{align*}
&=\int_z q(z|x) \log \frac{P_{\theta}(z, x)}{P_{\theta}(z|x)}\mathrm dz\\
&=\int_z q(z|x) \log \frac{P_{\theta}(z, x)q(z|x)}{q(z|x)P_{\theta}(z|x)}\mathrm dz\\
&=\int_z q(z|x) \log \frac{P_{\theta}(z, x)}{q(z|x)}\mathrm dz + \underline{\int_z q(z|x) \log \frac{q(z|x)}{P_{\theta}(z|x)}\mathrm dz}_{è¿™æ˜¯ KL æ•£åº¦ï¼Œå§‹ç»ˆå¤§äº0}\\
&\ge \int_z q(z|x) \log \frac{P_{\theta}(z, x)}{q(z|x)}\mathrm dz\\
&= \underline{E_{z\sim q(z|x)}[\log \frac{P_{\theta}(z, x)}{q(z|x)}]}_{VAE çš„ç›®æ ‡å°±æ˜¯è®©è¿™ä¸ªå–åˆ°æœ€å¤§å€¼}
\end{align*}
$$


<p>æœ€åä¸€è¡Œè¿™ä¸ªï¼Œå°±æ˜¯ç›®æ ‡çš„ä¸‹ç•Œï¼Œæ˜¯ VAE æœ€ç»ˆçš„ä¼˜åŒ–ç›®æ ‡ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤ŸæŠŠåŸå§‹ç›®æ ‡çš„ä¸‹ç•Œå˜å¾—æœ€å¤§ï¼Œé‚£ä¹ˆåŸå§‹ç›®æ ‡å¤§æ¦‚ç‡ä¹Ÿä¼šå°½å¯èƒ½åœ°å¢å¤§ã€‚è¿™ä¸ªä¸‹ç•Œå…¶å®å°±æ˜¯ ELBOï¼Œä¿è¯äº†æ¨¡å‹çš„æœ€åæƒ…å†µä¸ä¼šæ¯”ä¸‹ç•Œæ›´å·®ã€‚ $q(z|x)$  å…¶å®æ˜¯ä¸€ä¸ªç¼–ç å™¨ï¼ˆæŠŠå›¾åƒæ˜ å°„ä¸ºå‘é‡ï¼‰ï¼Œå®ƒè¾“å‡ºçš„ä¹Ÿæ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œä¸ç®¡è¿™ä¸ªç¼–ç å™¨è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒé•¿ä»€ä¹ˆæ ·ï¼Œä¸Šé¢çš„å…¬å¼éƒ½æ˜¯æˆç«‹çš„ã€‚VAE æœ‰ç‰¹æ®Šçš„æŠ€å·§æ¥åŒæ—¶ä¼˜åŒ–ç¼–ç å™¨å’Œè§£ç å™¨ï¼ˆé‡å‚æ•°åŒ–ç­‰ç­‰ï¼‰ï¼Œä¸è¿‡è¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚æˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹çœ‹ Diffusion å§ã€‚</p>
<h2 id="DDPM-çš„ä¼˜åŒ–è¿‡ç¨‹"><a href="#DDPM-çš„ä¼˜åŒ–è¿‡ç¨‹" class="headerlink" title="DDPM çš„ä¼˜åŒ–è¿‡ç¨‹"></a>DDPM çš„ä¼˜åŒ–è¿‡ç¨‹</h2><p>Diffsion çš„é€šä¿—ç†è§£åº”è¯¥å¾ˆç›´è§‚å§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/../images/DDPM/1753424129654.png" alt="1753424129654" loading="lazy"></p>
<p>Diffusion çš„æœ¬ä¹‰æ˜¯æ‰©æ•£ï¼ŒæŠŠä¸€é¢—è§„åˆ™çš„æ–¹ç³–æ”¾åˆ°æ°´é‡Œï¼Œå®ƒä¼šé€æ¸æº¶è§£ï¼Œç³–åˆ†å­æ‰©æ•£åˆ°æº¶æ¶²çš„æ¯ä¸€å¤„ï¼Œæœ€å¼€å§‹çš„æ–¹ç³–åˆ†å­ï¼Œåˆ†å¸ƒæ˜¯è§„åˆ™çš„ï¼Œåˆ°äº†æœ€åå˜æˆäº†å®Œå…¨æ— è§„å¾‹çš„åˆ†å¸ƒï¼Œå’Œå®Œå…¨éšæœºåˆ†å¸ƒæ²¡æœ‰åŒºåˆ«ã€‚æˆ‘ä»¬å¯ä»¥æƒ³æƒ³å¦‚ä½•â€œæº¶è§£â€å›¾åƒï¼ŒæŠŠå›¾åƒå’Œé«˜æ–¯ä¿¡å·ä¸æ–­åœ°æ··åˆï¼Œæ¯ä¸€æ­¥æ·»åŠ ä¸€ç‚¹é«˜æ–¯å™ªå£°ï¼Œå›¾åƒå°±ä»æœ€å¼€å§‹çš„è§„åˆ™åˆ†å¸ƒ  $x_0$  å˜æˆäº†å®Œå…¨éšæœºçš„é«˜æ–¯å™ªå£°  $x_T$ ã€‚</p>
<p>é‚£ä¹ˆï¼Œåè¿‡æ¥å‘¢ï¼Ÿéšæœºä»é«˜æ–¯åˆ†å¸ƒä¸­å–å‡ºä¸€ä¸ªå™ªå£°  $x_T$ ï¼Œæˆ‘ä»¬èƒ½å¦é€†æ¨å‡ºæœ€å¼€å§‹çš„è§„åˆ™åˆ†å¸ƒ  $x_0$ ï¼Ÿè¿™å°±æ˜¯æ‰©æ•£æ¨¡å‹æ‰€åšçš„äº‹æƒ…ã€‚æ‰©æ•£æ¨¡å‹æŠŠ  $x_T$  ä¸€æ­¥ä¸€æ­¥å»å™ªå˜æˆ  $x_{T-1}, \dots, x_{1}, x_0$ ï¼Œå®ƒæ¯æ¬¡æ¥å— t æ—¶åˆ»å¸¦æœ‰å™ªå£°çš„å›¾åƒ  $x_t$ ï¼Œè¾“å‡ºåŠ å™ªä¹‹å‰çš„ä¸Šä¸€æ—¶åˆ»å›¾åƒ  $x_{t-1}$ ã€‚å¯ä»¥çœ‹å‡ºå®ƒå’Œ VAE å…¶å®æœ‰å‡ åˆ†ç›¸ä¼¼æ€§ï¼Œè¾“å…¥ä¸€ä¸ªé«˜æ–¯å‘é‡ï¼Œæœ€ç»ˆè¾“å‡ºä¸€å¼ å›¾åƒã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå»å™ªè¿‡ç¨‹çš„æ¯ä¸€æ­¥éƒ½çœ‹ä½œä¸€æ¬¡ VAE è§£ç ï¼Œå³  $z = x_t$ ï¼Œ $x = x_{t-1}$ ï¼Œé‚£ä¹ˆæ‰©æ•£æ¨¡å‹å®é™…ä¸Šå°±æ˜¯ T ä¸ªè§£ç å™¨è¢«è®­ç»ƒåœ¨äº†ä¸€ä¸ªæ¨¡å‹é‡Œé¢ï¼š</p>

$$
P_{\theta}(x_0) = \int_{x_1:x_T} P(x_T)P_{\theta}(x_{T-1}|x_T)\dots P_{\theta}(x_0|x_1)\mathrm dx_1:x_T
$$


<p>ï¼ˆæ³¨ï¼šè¿˜çœŸæœ‰çº§è”å¤šä¸ª VAE çš„æ¶æ„â€”â€”HVAE. DDPM å¯ä»¥çœ‹ä½œå®ƒçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œç”¨åŠ å™ªè¿‡ç¨‹æ›¿ä»£äº†ç¼–ç å™¨ã€‚ï¼‰</p>
<h3 id="æ¨å¯¼æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ"><a href="#æ¨å¯¼æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ" class="headerlink" title="æ¨å¯¼æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ"></a>æ¨å¯¼æœ€å¤§ä¼¼ç„¶çš„ä¸‹ç•Œ</h3><p>ä¾ç„¶æ˜¯æœ€å¤§ä¼¼ç„¶å…¬å¼ï¼Œæ‰©æ•£æ¨¡å‹å®é™…ä¸Šå°±æ˜¯ n ä¸ª VAE çš„çº§è”ï¼š</p>

$$
\begin{align*}
\log P_{\theta}(x_0) &= \int_{x_1:x_T}q(x_1:x_T|x_0)\log P_\theta(x_0)\mathrm dx_1:x_T\\
&= \int_{x_1:x_T}q(x_1:x_T|x_0)\log P_\theta(x_0)\mathrm dx_1:x_T\\
&= \int_{x_1:x_T}q(x_1:x_T|x_0)\log \frac{P_\theta(x_0:x_T)}{P_\theta(x_1:x_T|x_0)}\mathrm dx_1:x_T\\
&= \int_{x_1:x_T}q(x_1:x_T|x_0)\log \frac{P_\theta
(x_0:x_T)q(x_1:x_T|x_0)}{q(x_1:x_T|x_0)P_\theta(x_1:x_T|x_0)}\mathrm dx_1:x_T\\
&= \int_{x_1:x_T}q(x_1:x_T|x_0)\log \frac{P_\theta(x_0:x_T)}{q(x_1:x_T|x_0)}\mathrm dx_1:x_T \\
&+ \underline{\int_{x_1:x_T}q(x_1:x_T|x_0)\log \frac{q(x_1:x_T|x_0)}{P_\theta(x_1:x_T|x_0)}\mathrm dx_1:x_T}_{KL æ•£åº¦ \ge 0}\\
&\ge \int_{x_1:x_T}q(x_1:x_T|x_0)\log \frac{P_\theta(x_0:x_T)}{q(x_1:x_T|x_0)}\mathrm dx_1:x_T\\
&= \underline{E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log \frac{P_\theta(x_0:x_T)}{q(x_1:x_T|x_0)}]}_{ELBO}
\end{align*}
$$


<p>ä»¥ä¸Šæ¨å¯¼å’Œ VAE å®Œå…¨ä¸€æ ·ã€‚è¿™é‡Œçš„  $x_0$  å°±æ˜¯æœ€ç»ˆçš„å›¾åƒï¼Œå’Œ VAE çš„  $x$  ä¸€æ ·ã€‚åœ¨ VAE é‡Œè¿™ä¸ª q é¡¹æ˜¯ä¸ªç¼–ç å™¨ï¼Œè¦è®­ç»ƒçš„ã€‚ä½†æ˜¯åœ¨ Diffusion é‡Œé¢ï¼Œè¿™é‡Œçš„  $q(x_1:x_T|x_0)$  å«ä¹‰æ˜¯åŠ å™ªè¿‡ç¨‹ï¼Œå³è¾“å…¥å›¾åƒï¼Œè¾“å‡ºåŠ å™ªåçš„å›¾åƒï¼Œå®ƒæ— éœ€è®­ç»ƒï¼Œæ˜¯å·²ç»å®šä¹‰å¥½çš„ï¼š</p>

$$
q(x_1:x_T|x_0) = q(x_T|x_{T-1})\dots q(x_1|x_0)
$$


<h3 id="ä»-ELBO-æ¨å¯¼-DDPM-è®­ç»ƒæ—¶çš„ä¼˜åŒ–ç›®æ ‡"><a href="#ä»-ELBO-æ¨å¯¼-DDPM-è®­ç»ƒæ—¶çš„ä¼˜åŒ–ç›®æ ‡" class="headerlink" title="ä» ELBO æ¨å¯¼ DDPM è®­ç»ƒæ—¶çš„ä¼˜åŒ–ç›®æ ‡"></a>ä» ELBO æ¨å¯¼ DDPM è®­ç»ƒæ—¶çš„ä¼˜åŒ–ç›®æ ‡</h3><p>ç°åœ¨é—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè®­ç»ƒè¿‡ç¨‹çš„ loss å…¬å¼è·Ÿæˆ‘ä»¬æœ´ç´ çš„ç†è§£å®Œå…¨ä¸ä¸€æ ·å‘¢ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯ä»ä¸Šä¸€éƒ¨åˆ†è®¡ç®—å‡ºçš„ ELBO å…¥æ‰‹æ¥åˆ†æè¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å…¬å¼æ¨å¯¼æ¥è‡ª <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2208.11970">Understanding Diffusion Models: A Unified Perspective</a>ã€‚æœ¬æ–‡ä»å¤šç§è§’åº¦é‡‡ç”¨ä¸åŒçš„ç†è®ºåˆ†æ Variational Diffusion Modelï¼Œå¯è§ Diffusion Model æ˜¯ä¸€ç§åœ¨æ•°å­¦ä¸Šå¤šä¹ˆä¼˜ç¾çš„æ¶æ„ã€‚åœ¨ä¼˜åŒ– ELBO è¿™ä¸€éƒ¨åˆ†ï¼Œä½œè€…åšäº†ä¸¤ç§ä¸åŒçš„ç­‰ä»·å˜å½¢æ¥æ¨å¯¼ä¼˜åŒ–å…¬å¼ï¼Œå…¶ä¸­ä¸€ç§æ€è·¯æ¯”è¾ƒç®€å•ç›´æ¥ï¼Œä½†æ˜¯ä¸åˆ©äºç”¨ä½œçœŸå®çš„ç®—æ³•ä¼˜åŒ–è¿‡ç¨‹ï¼›å¦ä¸€ç§åˆ™æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ä»‹ç»çš„ã€‚</p>
<p>é¦–å…ˆè¦æ³¨æ„åˆ°ä¸€ä¸ªå˜å½¢æŠ€å·§ï¼š</p>

$$
q(x_t|x_{t-1}) = q(x_t|x_{t-1}, x_0)
$$


<p>è¿™æ˜¯å¾ˆæ˜¾ç„¶çš„ï¼Œå› ä¸ºåŠ å™ªè¿‡ç¨‹çš„ç¬¬ t æ­¥åªä¾èµ–äºç¬¬ t-1 æ­¥ï¼Œä½ æŠŠåŸå§‹å›¾åƒåŠ è¿›æ¥ä½œä¸ºæ¡ä»¶ä¸ä¼šå¯¹æ¦‚ç‡é€ æˆä»»ä½•å½±å“ã€‚ç„¶è€Œè¿™ä¸ªç¥ç§˜æ“ä½œå´å¯¹æˆ‘ä»¬æ¥ä¸‹æ¥çš„è®¡ç®—è‡³å…³é‡è¦ï¼š</p>

$$
\begin{align*}
&E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log \frac{P_\theta(x_0:x_T)}{q(x_1:x_T|x_0)}]\\
&=E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log\frac{P(x_T)P_{\theta}(x_0|x_1)\prod_{t=2}^T P_{\theta}(x_{t-1}|x_t)}{q(x_1|x_0)\prod_{t=2}^Tq(x_t|x_{t-1})}]\\
&=E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log\frac{P(x_T)P_{\theta}(x_0|x_1)\prod_{t=2}^T P_{\theta}(x_{t-1}|x_t)}{q(x_1|x_0)\prod_{t=2}^T\underline{q(x_t|x_{t-1}, x_0)}_{æ³¨æ„è¿™é‡Œç”¨åˆ°äº†ç¥ç§˜æŠ€å·§ï¼}}]\\
&=E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log\frac{P(x_T)P_{\theta}(x_0|x_1)\prod_{t=2}^T P_{\theta}(x_{t-1}|x_t)}{q(x_1|x_0)\prod_{t=2}^T\underline{\frac{q(x_{t-1}|x_t, x_0)q(x_t|x_0)}{q(x_{t-1}|x_0)}}_{åªæ˜¯æ™®é€šçš„è´å¶æ–¯}}]\\
&=E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log\frac{P(x_T)P_{\theta}(x_0|x_1)\prod_{t=2}^T P_{\theta}(x_{t-1}|x_t)}{q(x_1|x_0)\cdot\prod_{t=2}^Tq(x_{t-1}|x_t, x_0)\cdot \underline{\prod_{t=2}^T\frac{q(x_t|x_0)}{q(x_{t-1}|x_0)}}_{è¿™é‡Œå¯ä»¥é”™ä½ç›¸æ¶ˆ}}]\\
&=E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log\frac{P(x_T)P_{\theta}(x_0|x_1)\prod_{t=2}^T P_{\theta}(x_{t-1}|x_t)}{q(x_1|x_0)\cdot\frac{q(x_T|x_0)}{q(x_1|x_0)}\cdot \prod_{t=2}^Tq(x_{t-1}|x_t, x_0)}]\\
&=E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log\frac{P(x_T)P_{\theta}(x_0|x_1)\prod_{t=2}^T P_{\theta}(x_{t-1}|x_t)}{q(x_T|x_0)\prod_{t=2}^Tq(x_{t-1}|x_t, x_0)}]\\
&=E_{x_1:x_T \sim q(x_1:x_T|x_0)}[\log P_{\theta}(x_0|x_1) + \log\frac{P(x_T)}{q(x_T|x_0)} + \log\frac{\prod_{t=2}^T P_{\theta}(x_{t-1}|x_t)}{\prod_{t=2}^Tq(x_{t-1}|x_t, x_0)}]\\
&=E_{x_1\sim q(x_1|x_0)}[\log P_\theta(x_0|x_1)] + E_{x_T\sim q(x_T|x_0)}[\log\frac{P(x_T)}{q(x_T|x_0)}] + \underline{\sum_{t=2}^TE_{x_{t-1},x_t \sim q(x_{t-1},x_t|x_0)}[\log\frac{P_{\theta}(x_{t-1}|x_t)}{q(x_{t-1}|x_t, x_0)}]}_{è¿™ä¸€é¡¹çš„åŒ–ç®€å†™åœ¨åé¢äº†}\\
&=E_{x_1\sim q(x_1|x_0)}[\log P_\theta(x_0|x_1)] - KL[{q(x_T|x_0)}||P(x_T)] -\sum_{t=2}^T E_{x_t\sim q(x_t|x_0)}[KL[q(x_{t-1}|x_t, x_0)||P_{\theta}(x_{t-1}|x_t)]]\\
\end{align*}
$$


<p>å…¶ä¸­ï¼Œç¬¬ä¸‰é¡¹çš„åŒ–ç®€ï¼š</p>

$$
\begin{align*}
&\sum_{t=2}^TE_{x_{t-1},x_t \sim q(x_{t-1},x_t|x_0)}[\log\frac{P_{\theta}(x_{t-1}|x_t)}{q(x_{t-1}|x_t, x_0)}]\\
&=\sum_{t=2}^T\int_{x_{t-1}, x_t}q(x_{t-1},x_t|x_0)\log\frac{P_{\theta}(x_{t-1}|x_t)}{q(x_{t-1}|x_t, x_0)}\mathrm dx_{t-1}\mathrm dx_t\\
&=\sum_{t=2}^T\int_{x_{t-1}, x_t}q(x_{t-1}|x_t,x_0)q(x_t|x_0)\log\frac{P_{\theta}(x_{t-1}|x_t)}{q(x_{t-1}|x_t, x_0)}\mathrm dx_{t-1}\mathrm dx_t\\
&=\sum_{t=2}^T\int_{x_t}q(x_t|x_0)\int_{x_{t-1}}q(x_{t-1}|x_t,x_0)\log\frac{P_{\theta}(x_{t-1}|x_t)}{q(x_{t-1}|x_t, x_0)}\mathrm dx_{t-1}\mathrm dx_t\\
&=-\sum_{t=2}^T\int_{x_t}q(x_t|x_0)KL[q(x_{t-1}|x_t, x_0)||P_{\theta}(x_{t-1}|x_t)]\mathrm dx_t\\
&=-\sum_{t=2}^T E_{x_t\sim q(x_t|x_0)}[KL[q(x_{t-1}|x_t, x_0)||P_{\theta}(x_{t-1}|x_t)]]
\end{align*}
$$


<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸‰é¡¹ä¼˜åŒ–ç›®æ ‡ï¼Œå®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li> $E_{x_1\sim q(x_1|x_0)}[\log P_\theta(x_0|x_1)]$  ä¸º reconstruction termï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯æœ€åä¸€æ­¥é‡å»ºï¼Œå³ä»  $x_1$  æ¢å¤åŸå›¾  $x_0$  çš„è¿‡ç¨‹ï¼Œå¯ç±»æ¯”äº VAE ä¸­çš„ä»é«˜æ–¯å‘é‡ z æ¢å¤åŸå›¾ xï¼›</li>
<li> $KL[{q(x_T|x_0)}||P(x_T)]$  ä¸º prior matching termï¼Œè¿™æ˜¯æ‰€æœ‰ VAE ç±»å‹çš„æ¨¡å‹å…±æœ‰çš„ã€‚åœ¨è¿™é‡Œï¼Œ $P(x_T)$  æ˜¯ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼ˆæƒ³æƒ³ï¼Œè¿™å°±æ˜¯æ‰©æ•£æ¨¡å‹æ¨ç†æ—¶è¾“å…¥çš„é‚£ä¸ªéšæœºé«˜æ–¯å‘é‡ï¼‰ï¼Œè€Œ  $q(x_T|x_0)$  ä¸ºåŠ å™ªè¿‡ç¨‹ï¼Œå›¾åƒåŠ  T æ­¥å™ªå£°åä¹Ÿè¿‘ä¼¼ä¸ºé«˜æ–¯ï¼Œæ‰€ä»¥è¿™ä¸€é¡¹å®é™…ä¸Šä¸º 0ã€‚è¿™é‡Œæ²¡æœ‰éœ€è¦è®­ç»ƒçš„å‚æ•°ï¼Œå¯ä»¥å¿½ç•¥ï¼›</li>
<li> $E_{x_t\sim q(x_t|x_0)}[KL[q(x_{t-1}|x_t, x_0)||P_{\theta}(x_{t-1}|x_t)]]$  å°±æ˜¯ denoising matching termï¼Œè¿™é‡Œæ˜¯ä»€ä¹ˆ match ä»€ä¹ˆå‘¢ï¼Œæ˜¯æ‰©æ•£æ¨¡å‹  $P_{\theta}(x_{t-1}|x_t)$  å» Match ä¸€ä¸ªè®­ç»ƒé›†é‡Œçš„å»å™ªè¿‡ç¨‹  $q(x_{t-1}|x_t, x_0)$ ã€‚ $q$  åŸæœ¬æ˜¯æ¥è‡ªåŠ å™ªè¿‡ç¨‹çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»é€šè¿‡è´å¶æ–¯æŠŠå®ƒè½¬æ¢æˆäº†å»å™ªè¿‡ç¨‹çš„æ¦‚ç‡ï¼Œå®ƒç°åœ¨ä½œä¸ºä¸€ä¸ª ground truth ä¿¡å·å»ç›‘ç£æ¨¡å‹å­¦ä¹ ï¼Œå«ä¹‰æ˜¯â€œå·²çŸ¥äº†çœŸå®å›¾åƒ  $x_0$  çš„æƒ…å†µä¸‹ï¼Œå»å™ªè¿‡ç¨‹åº”è¯¥æ˜¯ä»€ä¹ˆæ ·â€ã€‚æˆ‘ä»¬è®­ç»ƒçš„æ¨¡å‹åœ¨ä¸çŸ¥é“çœŸå®å›¾åƒçš„å‰æä¸‹å­¦ä¹ è¿™ä¸ªç”±  $q$  æŒ‡å¯¼çš„å»å™ªè¿‡ç¨‹ï¼Œå®ƒå°±èƒ½é€æ¸æŒæ¡å¦‚ä½•ç”Ÿæˆä¸€ä¸ªçœŸå®å›¾åƒäº†ã€‚</li>
</ol>
<h3 id="çœŸæ­£çš„-DDPM-è®­ç»ƒ"><a href="#çœŸæ­£çš„-DDPM-è®­ç»ƒ" class="headerlink" title="çœŸæ­£çš„ DDPM è®­ç»ƒ"></a>çœŸæ­£çš„ DDPM è®­ç»ƒ</h3><p>DDPM çš„ä¼˜åŒ–ç›®æ ‡æˆ‘ä»¬å·²ç»åœ¨ä¸Šä¸€éƒ¨åˆ†æ¨å‡ºå®Œæ¯•ï¼Œä½†æ˜¯å’ŒçœŸæ­£çš„å…¬å¼å¥½åƒè¿˜æ˜¯æœ‰ä¸€äº› gapï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬çš„å…¬å¼é‡Œé¢æŠŠåŠ å™ªè¿‡ç¨‹çš„å™ªå£°åˆ†å¸ƒå†™æˆäº†  $q$ ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬æ—©å°±çŸ¥é“ï¼Œè¿™ä¸ª  $q$  å…¶å®ä»£è¡¨çš„æ˜¯ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æŠŠé«˜æ–¯åˆ†å¸ƒçš„å®é™…è¡¨è¾¾å¼ä»£è¿›å»ç®—äº†ã€‚åœ¨è®¡ç®—ä¹‹å‰ï¼Œæˆ‘ä»¬å†æ¥è¯¦ç»†åˆ†æä¸€ä¸‹â€œåŠ å™ªè¿‡ç¨‹â€çš„ç»†èŠ‚ã€‚</p>
<h4 id="åŠ å™ªè¿‡ç¨‹çš„ç»†èŠ‚"><a href="#åŠ å™ªè¿‡ç¨‹çš„ç»†èŠ‚" class="headerlink" title="åŠ å™ªè¿‡ç¨‹çš„ç»†èŠ‚"></a>åŠ å™ªè¿‡ç¨‹çš„ç»†èŠ‚</h4><p><img src="/../images/DDPM/1753442174434.png" alt="1753442174434" loading="lazy"></p>
<p>æ‰€è°“çš„â€œåŠ å™ªâ€è¿ç®—ï¼Œå…¶å®æ˜¯æŠŠè¾“å…¥ä¿¡å·å’Œæ ‡å‡†é«˜æ–¯å™ªå£°æŒ‰ç…§æŸç§æ¯”ä¾‹æ··åˆï¼š</p>

$$
x_t = \sqrt{\alpha_t}x_{t-1} + \sqrt{1-\alpha_t}\varepsilon, \varepsilon \sim \mathcal N(0, I)
$$


<p>æˆ‘ä»¬å¯ä»¥äººä¸ºè§„å®šä¸€ç»„å¸¸æ•°  $\lbrace\alpha_1, \alpha_2, \dots\alpha_T\rbrace$ ï¼Œè¡¨ç¤ºä¸åŒæ—¶åˆ»è¾“å…¥ä¿¡å·  $x_{t-1}$  çš„å¼ºåº¦ã€‚ $\alpha$  è¶Šå¤§ï¼Œåˆ™è¾“å‡ºçš„ä¿¡å·å’Œè¾“å…¥ä¿¡å·è¶Šç›¸ä¼¼ï¼Œè¶Šå°ï¼Œåˆ™è¾“å‡ºä¿¡å·è¶Šæ¥è¿‘å™ªå£°ã€‚</p>
<p>ä¸ºä»€ä¹ˆç³»æ•°è¦æœ‰æ ¹å·ï¼Ÿå®¹æ˜“è§‚å¯Ÿåˆ°ï¼Œç­‰å·å³ä¾§çš„ä¸¤ä¸ªç³»æ•°çš„å¹³æ–¹ä¹‹å’Œç­‰äº 1ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯æ··åˆå‰åä¿¡å·çš„æ–¹å·®ä¿æŒä¸å˜ã€‚ä¸éš¾æ¨å¯¼ï¼Œä¸¤ä¸ªæ–¹å·®ä¸º 1 çš„é«˜æ–¯ä¿¡å·æŒ‰ç…§ä¸Šè¿°  $\alpha$  çš„æ¯”ä¾‹æ··åˆä»¥åè¿˜æ˜¯ä¸€ä¸ªæ–¹å·®ä¸º 1 çš„é«˜æ–¯ä¿¡å·ã€‚</p>
<p>ç„¶è€Œï¼Œè®­ç»ƒæ—¶æˆ‘ä»¬ä¸æ˜¯ä¸€æ­¥æ­¥åœ°ä»  $x_0$  åŠ å™ªä¸€ç›´åˆ°  $x_T$ ï¼Œè¿™æ ·å®åœ¨å¤ªæ…¢äº†ï¼å¥½åœ¨é«˜æ–¯ä¿¡å·æ˜¯çº¿æ€§çš„ä¸œè¥¿ï¼Œä¸¤ä¸ªé«˜æ–¯åŠ åœ¨ä¸€èµ·è¿˜æ˜¯é«˜æ–¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ¨å¯¼å‡º  $x_t$  å’Œ  $x_0$  çš„å…³ç³»ï¼š</p>

$$
\begin{align*}
x_t &= \sqrt{\alpha_t}x_{t-1} + \sqrt{1-\alpha_t}\varepsilon_{t-1}\\
&= \sqrt{\alpha_t}(\sqrt{\alpha_{t-1}}x_{t-2} + \sqrt{1-\alpha_{t-1}}\varepsilon_{t-1}) + \sqrt{1-\alpha_t}\varepsilon_{t-1}\\
&= \sqrt{\alpha_t\alpha_{t-1}}x_{t-2} +  \sqrt{\alpha_t(1-\alpha_{t-1})}\varepsilon_{t-2} + \sqrt{1-\alpha_t}\varepsilon_{t-1}\\
&(è®¾ \varepsilon^*_{t-2} = \sqrt{\alpha_t(1-\alpha_{t-1})}\varepsilon_{t-2} + \sqrt{1-\alpha_t}\varepsilon_{t-1} \sim \mathcal N(0, I))\\
&= {\sqrt{\alpha_t\alpha_{t-1}}x_{t-2} + \sqrt{\alpha_t(1-\alpha_{t-1}) + (1-\alpha_t)}\varepsilon^*_{t-2}}\\
&= \sqrt{\alpha_t\alpha_{t-1}}x_{t-2} + \sqrt{1-\alpha_t\alpha_{t-1}}\varepsilon_{t-2}^*\\
&=\dots\\
&=\sqrt{\alpha_t\alpha_{t-1}\dots\alpha_1}x_0 + \sqrt{1 - \alpha_t\alpha_{t-1}\dots\alpha_1}\varepsilon^*_{0}\\
&(\varepsilon^*_0 \sim \mathcal N(0, I))
\end{align*}
$$


<p>æˆ‘ä»¬è®°  $\bar{\alpha_t} = \alpha_t\alpha_{t-1}\dots\alpha_1$ ï¼Œåˆ™ä¸Šå¼å¯ä»¥å†™ä¸º</p>

$$
x_t = \sqrt{\bar\alpha_t} x_{0} + \sqrt{1 - \bar\alpha_t}\varepsilon, \varepsilon \sim \mathcal N(0, I)
$$


<h4 id="è®¡ç®—-DDPM-çš„ä¼˜åŒ–ç›®æ ‡"><a href="#è®¡ç®—-DDPM-çš„ä¼˜åŒ–ç›®æ ‡" class="headerlink" title="è®¡ç®— DDPM çš„ä¼˜åŒ–ç›®æ ‡"></a>è®¡ç®— DDPM çš„ä¼˜åŒ–ç›®æ ‡</h4><p>æˆ‘ä»¬å…ˆæ¥è®¡ç®— denoising matching term  $E_{x_t\sim q(x_t|x_0)}[KL[q(x_{t-1}|x_t, x_0)||P_{\theta}(x_{t-1}|x_t)]]$ ã€‚é¦–å…ˆï¼Œæ ¹æ®ä¸Šé¢æ¨å¯¼å‡ºçš„  $x_t$  ä¸  $x_0$  çš„å…³ç³»ï¼Œ $q(x_t|x_0)$  æ˜¯å‡å€¼ä¸º  $\sqrt{\bar\alpha_t}x_{0}$  ï¼Œæ–¹å·®ä¸º  $({1 - \bar\alpha_t})I$  çš„é«˜æ–¯åˆ†å¸ƒã€‚</p>
<p>ç„¶è€Œï¼Œå»å™ªç›‘ç£ä¿¡å·  $q(x_{t-1}|x_t, x_0)$  çœ‹èµ·æ¥ä¸å¤ªå¥½ç®—ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è´å¶æ–¯å…¬å¼æŠŠå®ƒè½¬æ¢ä¸ºåŠ å™ªè¿‡ç¨‹ï¼š</p>

$$
\begin{align*}
q(x_{t-1}|x_t, x_0)&=\frac{q(x_{t-1}|x_0)q(x_{t}|x_{t-1}, x_0)}{q(x_{t}|x_0)}\\
&=\frac{q(x_{t-1}|x_0)q(x_{t}|x_{t-1})}{q(x_{t}|x_0)}\\
\end{align*}
$$


<p>è¿™é‡Œçš„åˆ†å­å’Œåˆ†æ¯çš„é¡¹å…¨éƒ¨éƒ½æ˜¯é«˜æ–¯åˆ†å¸ƒï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥è®¡ç®—äº†ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œè®¡ç®—ç»“æœè¿˜æ˜¯ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼Œå‡å€¼ä¸º</p>

$$
\mu_q(x_t) = \frac{\sqrt\alpha_t (1 - \bar\alpha_{t-1})x_t + \sqrt{\bar\alpha_{t-1}}(1-\alpha_t)x_0}{1-\bar\alpha_t}
$$


<p>æ–¹å·®ä¸º</p>

$$
\Sigma_q = \frac{(1-\alpha_t)(1-\bar\alpha_{t-1})}{1-\bar\alpha_t}I
$$


<p>æ‰©æ•£æ¨¡å‹  $P_{\theta}(x_{t-1}|x_t)$  çš„ç›®æ ‡æ˜¯é¢„æµ‹å™ªå£°ï¼Œé‚£ä¹ˆæŠŠå®ƒå»ºæ¨¡ä¸ºé«˜æ–¯åˆ†å¸ƒå°±å¾ˆæ˜¾ç„¶äº†ã€‚æˆ‘ä»¬å‡è®¾å®ƒçš„å‡å€¼ä¸º  $\mu_\theta(x_t)$  æ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„é‡ï¼ˆæ³¨æ„åˆ°è¿™å’Œæˆ‘ä»¬åœ¨ VAE é‡Œé¢å‡è®¾  $G_\theta(x)$  çš„è¾“å‡ºä¸ºé«˜æ–¯åˆ†å¸ƒä¸€è‡´ï¼‰ï¼Œæ–¹å·®å’Œç›‘ç£ä¿¡å·  $q(x_{t-1}|x_t, x_0)$  çš„æ–¹å·®ä¸€æ ·ï¼ˆå·²çŸ¥ï¼‰ã€‚</p>
<p>æ ¹æ® KL æ•£åº¦å…¬å¼</p>

$$
D_{\mathrm{KL}}(\mathcal{N}(\boldsymbol{x};\boldsymbol{\mu}_x,\boldsymbol{\Sigma}_x)\parallel\mathcal{N}(\boldsymbol{y};\boldsymbol{\mu}_y,\boldsymbol{\Sigma}_y))=\\
\frac{1}{2}\left[\log\frac{|\boldsymbol{\Sigma}_y|}{|\boldsymbol{\Sigma}_x|}-d+\mathrm{tr}(\boldsymbol{\Sigma}_y^{-1}\boldsymbol{\Sigma}_x)+(\boldsymbol{\mu}_y-\boldsymbol{\mu}_x)^T\boldsymbol{\Sigma}_y^{-1}(\boldsymbol{\mu}_y-\boldsymbol{\mu}_x)\right]
$$


<p>æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡º</p>

$$
\begin{align*}
&KL[q(x_{t-1}|x_t, x_0)||P_{\theta}(x_{t-1}|x_t)] \\
&= \frac12\left[\log\frac{|\boldsymbol{\Sigma}_q|}{|\boldsymbol{\Sigma}_q|}-d+\mathrm{tr}(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Sigma}_q)+(\boldsymbol{\mu}_\theta-\boldsymbol{\mu}_q)^T\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{\mu}_q-\boldsymbol{\mu}_q)\right]\\
&=\frac12\left[0-d+d+\frac1{\sigma_q^2}||\boldsymbol{\mu}_\theta-\boldsymbol{\mu}_q||^2_2\right]\\
&=\frac1{2\sigma_q^2}||\boldsymbol{\mu}_\theta-\boldsymbol{\mu}_q||^2_2\\
\end{align*}
$$


<p>è¿™ä¹Ÿå¾ˆç¬¦åˆç›´è§‰ï¼Œæ¯•ç«Ÿé«˜æ–¯æ— éå°±æ˜¯ç”±å‡å€¼å’Œæ–¹å·®å†³å®šçš„ï¼Œæ–¹å·®æœ¬æ¥å°±æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€å‰©ä¸‹çš„ä¸å°±æ˜¯æ‹Ÿåˆå‡å€¼äº†å—ï¼Ÿé«˜æ–¯åˆ†å¸ƒä¸‹æ‹Ÿåˆå‡å€¼ï¼Œé‚£ä¸å°±æ˜¯ç”¨ MLE loss å—ï¼Ÿ</p>
<p>ç°åœ¨æˆ‘ä»¬ç»ˆäºæ‰¾åˆ°äº† DDPM çš„æŸå¤±å‡½æ•°ï¼š</p>

$$
\begin{align*}
&\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim q(x_t|x_0)}[KL[q(x_{t-1}|x_t, x_0)||P_{\theta}(x_{t-1}|x_t)]]\\
&=\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim q(x_t|x_0)}[||\mu_\theta(x_t)-\mu_q(x_t)||^2_2]\\
&=\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim }[||\mu_\theta(x_t)-\frac{\sqrt\alpha_t (1 - \bar\alpha_{t-1})x_t + \sqrt{\bar\alpha_{t-1}}(1-\alpha_t)x_0}{1-\bar\alpha_t}||^2_2]\\
&=\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim \mathcal N(\sqrt{\bar\alpha_t}x_{0}, ({1 - \bar\alpha_t})I)}[||\mu_\theta(x_t)-c_1x_t - c_2x_0||^2_2]\\
\end{align*}
$$


<p>å…¶ä¸­  $c_1, c_2$  æ˜¯å…³äº  $\lbrace\alpha_t\rbrace$  çš„è¡¨è¾¾å¼ï¼Œä¸  $\theta$  æ— å…³ã€‚ç”±äºæ¨¡å‹  $\mu_\theta$  è¾“å…¥é‡Œé¢å°±åŒ…å«  $x_t$ ï¼Œé‚£ä¹ˆ  $c_1x_t$  é¡¹å°±ä¸ç”¨è®©æ¨¡å‹é¢„æµ‹äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»¤</p>

$$
\mu_\theta(x_t) = c_1x_t + c_2x_\theta(x_t)
$$


<p>åˆ™ä¼˜åŒ–ç›®æ ‡ä¸º</p>

$$
\begin{align*}
&=\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim \mathcal N(\sqrt{\bar\alpha_t}x_{0}, ({1 - \bar\alpha_t})I)}[||c_1x_t + c_2x_\theta(x_t)-c_1x_t - c_2x_0||^2_2]\\
&=\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim \mathcal N(\sqrt{\bar\alpha_t}x_{0}, ({1 - \bar\alpha_t})I)}[||x_\theta(x_t) - x_0||^2_2]
\end{align*}
$$


<p>è¿™ä¸‹åäº†ï¼Œè¿™ä¸å°±æ˜¯è®©æˆ‘ä»¬çš„æ¨¡å‹ç›´æ¥é¢„æµ‹å‡ºåŸå›¾  $x_0$  å—ï¼ä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬ç»§ç»­åˆ†æ  $x_0$ ã€‚ç”±  $x_t$  å’Œ  $x_0$  çš„å…³ç³»å¯çŸ¥</p>

$$
x_t = \sqrt{\bar\alpha_t} x_{0} + \sqrt{1 - \bar\alpha_t}\varepsilon, \varepsilon \sim \mathcal N(0, I)\\
\Leftrightarrow x_0 = \frac{1}{\sqrt{\bar\alpha_t}} x_t - \frac{\sqrt{1 - \bar\alpha_t}}{\sqrt{\bar\alpha_t}}\varepsilon, \varepsilon \sim \mathcal N(0, I)
$$


<p>è¿™ä¸‹  $\frac{1}{\sqrt{\bar\alpha_t}} x_t$  å¯¹äº  $x_\theta(x_t)$  æ¥è¯´åˆæ˜¯å·²çŸ¥é¡¹ï¼Œäºæ˜¯æˆ‘ä»¬è¿›ä¸€æ­¥ä»¤</p>

$$
x_\theta(x_t) = \frac{1}{\sqrt{\bar\alpha_t}} x_t - \frac{\sqrt{1 - \bar\alpha_t}}{\sqrt{\bar\alpha_t}}\varepsilon_\theta(x_t)
$$


<p>ä¼˜åŒ–ç›®æ ‡è¿›ä¸€æ­¥åŒ–ç®€ï¼š</p>

$$
\begin{align*}
&=\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim \mathcal N(\sqrt{\bar\alpha_t}x_{0}, ({1 - \bar\alpha_t})I)}[||x_\theta(x_t) - x_0||^2_2]\\
&=\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim \mathcal N(\sqrt{\bar\alpha_t}x_{0}, ({1 - \bar\alpha_t})I)}[||\frac{1}{\sqrt{\bar\alpha_t}} x_t - \frac{\sqrt{1 - \bar\alpha_t}}{\sqrt{\bar\alpha_t}}\varepsilon_\theta(x_t) - \frac{1}{\sqrt{\bar\alpha_t}} x_t + \frac{\sqrt{1 - \bar\alpha_t}}{\sqrt{\bar\alpha_t}}\varepsilon||^2_2]\\
&=\argmin_\theta E_{t\sim U(2,T)} E_{x_t\sim \mathcal N(\sqrt{\bar\alpha_t}x_{0}, ({1 - \bar\alpha_t})I)}[||\varepsilon_\theta(x_t) -\varepsilon||^2_2]\\
&=\argmin_\theta E_{t\sim U(2,T)} E_{\varepsilon\sim \mathcal N(0, I)}[||\varepsilon_\theta(\sqrt{\bar\alpha_t} x_{0} + \sqrt{1 - \bar\alpha_t}\varepsilon) -\varepsilon||^2_2]\\
\end{align*}
$$


<p>ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼æˆ‘ä»¬çš„æ¨¡å‹ç°åœ¨å”¯ä¸€éœ€è¦é¢„æµ‹çš„å°±æ˜¯è¿™ä¸ªå™ªå£°é¡¹  $\varepsilon$  é•¿ä»€ä¹ˆæ ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨çš„æ‰©æ•£æ¨¡å‹  $\varepsilon_\theta$ ï¼Œè¾“å…¥æ˜¯  $t$  æ—¶åˆ»å«å™ªå›¾åƒ  $x_t$ ï¼Œè¦é¢„æµ‹çš„æ˜¯å…¶å«æœ‰çš„å™ªå£°  $\varepsilon$ ï¼è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æ¨å‡ºäº† DDPM çš„è®­ç»ƒç›®æ ‡ã€‚</p>
<p>åˆšæ‰æˆ‘ä»¬æ¨å¯¼çš„æŸä¸€æ­¥é‡ŒæŒ‡å‡ºï¼Œæˆ‘ä»¬çš„æŸå¤±å‡½æ•°ç­‰ä»·äºé¢„æµ‹åŸå›¾  $x_0$ ã€‚çš„ç¡®å¦‚æ­¤ï¼äº‹å®ä¸Šé¢„æµ‹åŸå›¾å’Œé¢„æµ‹å™ªå£°åœ¨åŸç†ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œå®ƒä»¬åªä¸è¿‡ç›¸å·®ä¸€äº›ç³»æ•°ã€‚ä½†æ˜¯ä¹Ÿæœ‰è®ºæ–‡æŒ‡å‡ºï¼Œé¢„æµ‹åŸå›¾å’Œé¢„æµ‹å™ªå£°ç›¸æ¯”ï¼Œpredicting the noise puts more weight on lower noise levelsï¼Œåœ¨ t è¾ƒå°çš„æƒ…å†µä¸ŠèŠ±è´¹æ›´å¤šç®—åŠ›è¿›è¡Œè®­ç»ƒã€‚</p>
<p>å¦å¤–ï¼Œå®é™…çš„ DDPM ä¼šå°†æ—¶é—´  $t$  ä¹Ÿä½œä¸ºä¸€ä¸ªæ¡ä»¶è¾“å…¥ç»™æ¨¡å‹  $\varepsilon_\theta$ ã€‚æˆ‘ä»¬å®é™…ä¸Šè®­ç»ƒçš„æ˜¯ï¼š</p>

$$
\argmin_\theta E_{t\sim U(2,T)} E_{\varepsilon\sim \mathcal N(0, I)}[||\varepsilon_\theta(t, \sqrt{\bar\alpha_t} x_{0} + \sqrt{1 - \bar\alpha_t}\varepsilon) -\varepsilon||^2_2]\\
$$


<p>åˆ«å¿˜äº†ï¼Œè¿™åªæ˜¯ ELBO ä¸‰é¡¹ä¸­çš„ä¸€é¡¹ï¼Œdenoise matching termã€‚æˆ‘ä»¬çŸ¥é“ï¼Œprior matching é¡¹ä¸å‚æ•°æ— å…³ä¸ç”¨è®­ç»ƒï¼›è¿˜å‰©ä¸‹ä¸€é¡¹ reconstructionï¼Œä¹Ÿå°±æ˜¯  $E_{x_1\sim q(x_1|x_0)}[\log P_\theta(x_0|x_1)]$  è¿™ä¸€é¡¹éœ€è¦è®¡ç®—ã€‚è¿™ä¸€é¡¹å…¶å®ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å‡è®¾æ¨¡å‹é¢„æµ‹é«˜æ–¯åˆ†å¸ƒï¼Œå‡å€¼ä¸º  $\mu_\theta(x_1)$ ï¼Œæ–¹å·®ä¸º  $(1-\alpha_1)I$  ä¸  $x_1$  ä¸€è‡´ï¼š</p>

$$
\begin{align*}
&E_{x_1\sim q(x_1|x_0)}[\log P_\theta(x_0|x_1)]\\
&=E_{\varepsilon\sim N}[\log P_\theta(x_0|\sqrt\alpha_1x_0+\sqrt{1 - \alpha_1}\varepsilon)]\\
&=E_{\varepsilon\sim N}[\log P_\theta(x_0|\sqrt\alpha_1x_0+\sqrt{1 - \alpha_1}\varepsilon)]\\
&=E_{\varepsilon\sim N}[\log (\frac{1}{\sqrt{2\pi(1 - \alpha_1)}})\exp [-\frac{||\mu_\theta(x_1) - (\sqrt\alpha_1x_0+\sqrt{1 - \alpha_1}\varepsilon)||_2^2}{2({1 - \alpha_1})}]]\\
&=E_{\varepsilon\sim N}[-\frac{||\mu_\theta(x_1) - (\sqrt\alpha_1x_0+\sqrt{1 - \alpha_1}\varepsilon)||_2^2}{2({1 - \alpha_1})}] + C\\
\end{align*}
$$


<p>å› æ­¤ï¼Œä¼˜åŒ–å®ƒä¸ºæœ€å¤§å€¼ç­‰ä»·äºä¼˜åŒ–</p>

$$
\begin{align*}
&\argmin_\theta E_{\varepsilon\sim N}[||\mu_\theta(x_1) - \sqrt\alpha_1x_0-\sqrt{1 - \alpha_1}\varepsilon||_2^2]\\
\end{align*}
$$


<p>æˆ‘ä»¬åˆæ•…æŠ€é‡æ–½ï¼Œé¢„æµ‹å®ƒçš„å™ªå£°ï¼š</p>

$$
\mu_\theta(x_1) = \sqrt\alpha_1x_0+\sqrt{1 - \alpha_1}\varepsilon_\theta(x_1)\\
$$



$$
\begin{align*}
&\argmin_\theta E_{\varepsilon\sim N}[||\mu_\theta(x_1) - \sqrt\alpha_1x_0-\sqrt{1 - \alpha_1}\varepsilon||_2^2]\\
&=\argmin_\theta E_{\varepsilon\sim N}[||\sqrt\alpha_1x_0+\sqrt{1 - \alpha_1}\varepsilon_\theta(x_1) - \sqrt\alpha_1x_0-\sqrt{1 - \alpha_1}\varepsilon||_2^2]\\
&=\argmin_\theta E_{\varepsilon\sim N}[||\varepsilon_\theta(x_1) - \varepsilon||_2^2]\\
&=\argmin_\theta E_{\varepsilon\sim N}[||\varepsilon_\theta(\sqrt\alpha_1x_0+\sqrt{1 - \alpha_1}\varepsilon) - \varepsilon||_2^2]\\
\end{align*}
$$


<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™å’Œç¬¬ä¸‰é¡¹çš„ä¼˜åŒ–ç›®æ ‡æ˜¯ä¸€æ ·çš„ï¼åªä¸è¿‡æ­¤æ—¶  $t = 1$ ï¼Œè€Œä¹‹å‰  $t$  çš„èŒƒå›´æ˜¯  $[2, T]$ ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æŠŠä¸Šé¢ä¸¤ç§æƒ…å†µç»¼åˆèµ·æ¥å°±å¾—åˆ°äº†æœ€ç»ˆçš„è®­ç»ƒç›®æ ‡ï¼š</p>

$$
\argmin_\theta E_{t\sim U(1,T)} E_{\varepsilon\sim \mathcal N(0, I)}[||\varepsilon_\theta(t, \sqrt{\bar\alpha_t} x_{0} + \sqrt{1 - \bar\alpha_t}\varepsilon) -\varepsilon||^2_2]\\
$$


<p>ä½ é—®æˆ‘ä¸ºä»€ä¹ˆ t &#x3D; 1 çš„æ¦‚ç‡ä¸å…¶ä»–çš„æƒ…å†µç›¸åŒï¼Ÿæˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šã€‚æŒ‰ç…§ ELBO çš„è¦æ±‚è¿™ä¸¤ç§æƒ…å†µçš„ç³»æ•°æˆ–è®¸æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå½“å®ƒæ˜¯ä¸€æ ·çš„äº†ã€‚è¿™ä¸ªå¯èƒ½ä¼šå¯¼è‡´ä¸€äº› bias çš„å¼•å…¥ï¼Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰è®ºæ–‡è®¨è®ºè¿™ä¸ªã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬ç»ˆäºæå®šäº† DDPM çš„è®­ç»ƒè¿‡ç¨‹ï¼</p>
<h3 id="DDPM-çš„æ¨ç†è¿‡ç¨‹"><a href="#DDPM-çš„æ¨ç†è¿‡ç¨‹" class="headerlink" title="DDPM çš„æ¨ç†è¿‡ç¨‹"></a>DDPM çš„æ¨ç†è¿‡ç¨‹</h3><p>æ¨ç†è¿‡ç¨‹å°±æ˜¯ç»™å®šæ—¶é—´  $t$  å’Œè¯¥æ—¶åˆ»çš„å›¾åƒ  $x_{t}$ ï¼Œè¾“å‡ºä¸Šä¸€æ—¶åˆ»çš„å›¾åƒ  $x_{t-1}$ ï¼ˆæœ¬è´¨ä¸Šæ˜¯å»æ‰ä¸Šä¸€æ—¶åˆ»çš„å™ªå£°ï¼‰ã€‚æ¨å®Œä¸Šè¿°çš„è®­ç»ƒè¿‡ç¨‹ï¼Œæˆ‘æƒ³æ¨ç†å…¬å¼å·²ç»å‘¼ä¹‹æ¬²å‡ºäº†ï¼š</p>

$$
x_0 \approx x_\theta(x_t) = \frac{1}{\sqrt{\bar\alpha_t}} x_t - \frac{\sqrt{1 - \bar\alpha_t}}{\sqrt{\bar\alpha_t}}\varepsilon_\theta(x_t, t)\\
x_{t-1} \sim q(x_{t-1}|x_t, x_0) = \mathcal N (\mu_q(x_t), \Sigma_q)\\
ï¼ˆæ¡ä»¶ï¼št\ge2ï¼‰
$$


<p>ç”±æ­¤å¯ä»¥æ¨å‡º</p>

$$
\begin{align*}
x_{t-1} &= \frac{\sqrt\alpha_t (1 - \bar\alpha_{t-1})x_t + \sqrt{\bar\alpha_{t-1}}(1-\alpha_t)x_0}{1-\bar\alpha_t} + \sqrt{\frac{(1-\alpha_t)(1-\bar\alpha_{t-1})}{1-\bar\alpha_t}}\varepsilon\\
&\approx \frac{\sqrt\alpha_t (1 - \bar\alpha_{t-1})x_t + \sqrt{\bar\alpha_{t-1}}(1-\alpha_t)(\frac{1}{\sqrt{\bar\alpha_t}} x_t - \frac{\sqrt{1 - \bar\alpha_t}}{\sqrt{\bar\alpha_t}}\varepsilon_\theta(x_t, t))}{1-\bar\alpha_t} + \sigma_t \varepsilon\\
&=\frac{1}{\sqrt{\alpha_t}}(x_t - \frac{(1-\alpha_t)}{\sqrt{1 - \bar\alpha_t}}\varepsilon_\theta(x_t, t)) + \sigma_t \varepsilon
ï¼ˆæ¡ä»¶ï¼št\ge2ï¼‰
\end{align*}
$$


<p>è¿™å°±æ˜¯æ¨ç†è¿‡ç¨‹çš„å…¬å¼ã€‚å…¶ä¸­  $\varepsilon$  ä¸ºæ­£æ€åˆ†å¸ƒã€‚</p>
<p>ä¸è¿‡è¦æ³¨æ„ï¼Œè¿™ä¸ªå™ªå£°é¡¹  $\varepsilon$  çš„æ¥æºï¼Œå¯ä¸æ˜¯æ¥è‡ªæ‰©æ•£æ¨¡å‹  $\varepsilon_\theta(x_t, t)$  çš„éšæœºæ€§ï¼Œè€Œæ˜¯æ¥è‡ª  $q(x_t|x_{t-1},x_0)$ ã€‚ $\varepsilon_\theta(x_t, t)$  ä»£è¡¨äº†ä»  $x_t$  åˆ°  $x_0$  ç›¸å·®å¤šå°‘å™ªå£°ï¼Œè¿™ä¸ªå™ªå£°åœ¨ç»™å®š  $x_t$  å’Œ  $x_0$  çš„æƒ…å†µä¸‹æ˜¯å›ºå®šçš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¡®å®šå€¼ã€‚è™½ç„¶æ­¤æ—¶  $x_t$  å’Œ  $x_0$  éƒ½æ˜¯ç¡®å®šçš„ï¼Œä½†æ˜¯ä»  $x_t$  åˆ°  $x_{t-1}$  çš„è¿™ä¸ªè¿‡ç¨‹å¼•å…¥äº†æ–°çš„é«˜æ–¯å™ªå£°ï¼Œä½ å³ä½¿çŸ¥é“  $x_t$  å’Œ  $x_0$ ï¼Œä»ç„¶æ— æ³•ç¡®å®š  $x_{t-1}$  é•¿ä»€ä¹ˆæ ·ï¼è¿™ä¸ªéšæœºé¡¹  $\varepsilon$  ä»£è¡¨çš„å°±æ˜¯ï¼ˆå·²çŸ¥  $x_0$  çš„æƒ…å†µä¸‹ï¼‰ä»  $x_t$  åˆ°  $x_{t-1}$  çš„ä¸ç¡®å®šæ€§ã€‚</p>
<p>ä¸Šé¢çš„å…¬å¼åªé€‚ç”¨äº  $t\ge2$  çš„æƒ…å†µã€‚å¾ˆæ˜¾ç„¶ï¼Œ $t=1$  çš„æ—¶å€™ä½ ä¹Ÿæ²¡æœ‰  $q(x_{t-1}|x_{t}, x_0)$  å¯ç”¨å•Šã€‚è¯·å¾ªå…¶æœ¬ï¼Œ $t=1$  çš„æƒ…å†µå®é™…ä¸Šæ¥è‡ªäº ELBO çš„ reconstruct termï¼Œéœ€è¦ç”¨é‚£é‡Œçš„å…¬å¼è§£é‡Šã€‚æ‰€ä»¥  $t = 1$  çš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹å°±ç›´æ¥è¾“å‡ºæœ€ç»ˆå›¾åƒå°±è¡Œäº†ï¼Œä¸éœ€è¦æ·»åŠ å™ªå£°é¡¹ï¼ˆå› ä¸ºå™ªå£°æ¥è‡ªäº  $q(x_{t-1}|x_{t}, x_0)$ ï¼ï¼‰ï¼š</p>

$$
x_0 \approx x_\theta(x_1) = \frac{1}{\sqrt{\alpha_1}} x_1 - \frac{\sqrt{1 - \alpha_1}}{\sqrt{\alpha_1}}\varepsilon_\theta(x_1, 1)\\
$$


<p>ä¸è¿‡æˆ‘å¯»æ€ä¸€èˆ¬  $T=1000$ ï¼Œæœ€åä¸€æ­¥ææ€•å™ªå£°å«é‡å·²ç»å¾ˆä½äº†ã€‚</p>
<h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>æ¨ç†çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å–æ¦‚ç‡æœ€å¤§çš„æƒ…å†µä½œä¸º  $x_{t-1}$  çš„å€¼ï¼Œä¹Ÿå°±ç›´æ¥è®©  $\varepsilon = 0$ ï¼Ÿè¦æ˜¯è¿™ä¹ˆè®¾å®šï¼Œæˆ‘ä»¬ä¹‹å‰çš„æ¨å¯¼å°±ç™½åšäº†ï¼Œè¦çŸ¥é“ï¼Œæˆ‘ä»¬ä¹‹å‰å…¨éƒ¨éƒ½æ˜¯å‡è®¾æ¯ä¸€æ­¥å»å™ªéƒ½ç¬¦åˆé«˜æ–¯åˆ†å¸ƒï¼Œä½ ç›´æ¥è®©å™ªå£°ç­‰äºé›¶ï¼Œå…¶å®ç­‰ä»·äºè®©æ¯ä¸€æ­¥é«˜æ–¯çš„æ–¹å·®  $\sigma_t^2$  ç­‰äº 0ï¼Œç›´è§‰ä¸Šå¥½åƒé€€åŒ–æˆ auto encoder äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„æ‰€æœ‰å…¬å¼è‚¯å®šè¦å‘ç”Ÿå˜åŒ–ã€‚è¿™ä¸ªæœ‰ç©ºå¯ä»¥åˆ†æä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è®©æ‰€æœ‰çš„  $\sigma_t$  éƒ½ç­‰äº 0ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<p>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆ VAE è¾“å‡ºçš„æ—¶å€™ä¸éœ€è¦æ·»åŠ è¿™ä¸ªå™ªå£°é¡¹ï¼Ÿå¾ˆæ˜¾ç„¶ï¼ŒVAE ä¸å­˜åœ¨ denoise matching termï¼Œå®ƒåªæœ‰ reconstruct termï¼Œè¿™ä¸€é¡¹æ˜¯å’Œ  $t = 1$  çš„æ‰©æ•£æ¨¡å‹ä¸€æ ·ï¼Œä¸éœ€è¦åŠ å™ªå£°çš„ã€‚</p>
<p>æœ€åä¸€ä¸ªé—®é¢˜ã€‚æ—¢ç„¶å›¾åƒ  $x_0$  æ˜¯ä»å™ªå£°  $x_T$  å˜è¿‡æ¥çš„ï¼Œæ˜æ˜æ¯ä¸€æ­¥éƒ½æ˜¯å‡å»ä¸€ä¸ªå™ªå£°ï¼Œä¸ºä»€ä¹ˆå‡ç€å‡ç€å°±å˜æˆäº†ä¸€ä¸ªæœ‰è§„å¾‹çš„å›¾åƒï¼Ÿåˆ°åº•ä»å“ªä¸€æ­¥å¼€å§‹ï¼Œå™ªå£°ä¸å†æ˜¯å™ªå£°ï¼Œè€Œæ˜¯çªç„¶å˜å¾—æœ‰è§„å¾‹äº†ï¼Ÿå¬èµ·æ¥åƒä¸€ä¸ªè°·å †æ‚–è®ºã€‚è¿™ä¸ªé—®é¢˜æˆ‘è¿˜æ²¡æœ‰æƒ³æ¸…æ¥šï¼Œä¸è¿‡æˆ‘è§‰å¾—æ‰©æ•£æ¨¡å‹å°±æ˜¯åœ¨æ„å»º  $x_T$  åˆ°  $x_0$  çš„ä¸€ä¸ªæ˜ å°„ï¼Œåªæ˜¯è¿™ä¸ªæ˜ å°„è¦è¿­ä»£å¾ˆå¤šæ­¥è€Œå·²ï¼Œæ‰€ä»¥æˆ–è®¸ä»ä¸€å¼€å§‹å™ªå£°  $x_T$  å°±å·²ç»æ³¨å®šäº†ä¼šå¯¹åº”  $x_0$ ï¼Œå¹¶ä¸æ˜¯åœ¨ä¸­é—´æŸä¸€æ­¥çªå˜çš„ã€‚Flow Matching æ–¹æ³•èƒ½å¤Ÿç›´æ¥ç”¨ä¸€æ¡ç›´çº¿æ„å»ºè¿™ç§æ˜ å°„ï¼Œä¹Ÿè®¸ä¼šæŠŠè¿™ä¸ªé—®é¢˜å±•ç¤ºå¾—æ›´åŠ æ¸…æ¥šã€‚ï¼ˆå½“ç„¶ï¼Œå»å™ªè¿‡ç¨‹æ˜¯æœ‰ä¸€å®šéšæœºæ€§çš„ï¼Œä¹Ÿè®¸å®ƒä¸€å¼€å§‹æƒ³èµ°åˆ°å›¾åƒ Aï¼Œèµ°ç€èµ°ç€çªç„¶å°±å¾€å›¾åƒ B å»è·‘äº†ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å¤§æ¦‚è¿˜æœ‰æ›´å¥½çš„è§£é‡Šå§ã€‚ï¼‰</p>
<p>ï¼ˆé‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ Score Matching å‘¢ï¼Ÿï¼‰</p>
</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Blither Boom</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://blitherboom812.github.io/2025/07/25/DDPM/" title="æ‰©æ•£æ¨¡å‹ï¼ˆä¸€ï¼‰DDPM åŸç†å­¦ä¹ ">https://blitherboom812.github.io/2025/07/25/DDPM/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> unless otherwise stated.</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2025/08/10/DDIM/" rel="prev" title="æ‰©æ•£æ¨¡å‹ï¼ˆäºŒï¼‰DDIM å­¦ä¹ "><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">æ‰©æ•£æ¨¡å‹ï¼ˆäºŒï¼‰DDIM å­¦ä¹ </span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2024/07/25/llama3-1/" rel="next" title="Llama3.1 report"><span class="post-nav-text">Llama3.1 report</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 â€“ 2026 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Blither Boom</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v6.2.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18","12-13"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script></body></html>